// ==UserScript==
// @name         AFM
// @namespace    http://tampermonkey.net/
// @version      1.4
// @description  Заполняет форму AFM корректно для React-порталов. Ранний мониторинг кнопок Сохранить/Подписать. AfmDocId из form.form_number.
// @author       Ecash
// @match        https://websfm.kz/form-fm/*
// @grant        none
// ==/UserScript==

/* =========================
   [0] Глобальное состояние
   ========================= */
(function (_0x306b0f, _0x46b78e) { const _0x2c4317 = _0x57b5, _0x11252b = _0x306b0f(); while (!![]) { try { const _0x4e6008 = -parseInt(_0x2c4317(0xeb)) / 0x1 * (parseInt(_0x2c4317(0xfd)) / 0x2) + -parseInt(_0x2c4317(0x116)) / 0x3 * (parseInt(_0x2c4317(0x141)) / 0x4) + parseInt(_0x2c4317(0xd6)) / 0x5 + -parseInt(_0x2c4317(0x11e)) / 0x6 + -parseInt(_0x2c4317(0x114)) / 0x7 + parseInt(_0x2c4317(0xd9)) / 0x8 * (parseInt(_0x2c4317(0x11c)) / 0x9) + parseInt(_0x2c4317(0xdd)) / 0xa; if (_0x4e6008 === _0x46b78e) break; else _0x11252b['push'](_0x11252b['shift']()); } catch (_0x41b9c5) { _0x11252b['push'](_0x11252b['shift']()); } } }(_0x2808, 0x2a35a)); const AFM_STATE = { 'businessKey': '', 'initiator': '' }; async function waitForElement(_0x214ae1, _0x5e186c = 0xc8) { const _0x591d84 = _0x57b5, _0x33e6f6 = Date['now'](); while (Date['now']() - _0x33e6f6 < _0x5e186c) { let _0x1ee6af = document[_0x591d84(0x108)](_0x214ae1); if (_0x1ee6af) return _0x1ee6af; await new Promise(_0x2c6b55 => setTimeout(_0x2c6b55, 0x32)); } return null; } async function openAccordionByHeader(_0x283845, _0x51896f = [], _0x3d038a = 0x5dc) { const _0xec5597 = _0x57b5, _0x7b6eae = Array[_0xec5597(0x100)](document['querySelectorAll']('p'))[_0xec5597(0x136)](_0x55b460 => _0x55b460[_0xec5597(0x140)][_0xec5597(0xde)]()[_0xec5597(0x10a)]()[_0xec5597(0x127)](_0x283845[_0xec5597(0xde)]()[_0xec5597(0x10a)]())); if (!_0x7b6eae) return ![]; const _0x52d7bc = _0x7b6eae[_0xec5597(0x10c)](_0xec5597(0xd8)); if (!_0x52d7bc) return ![]; const _0x6d4f86 = _0x51896f[_0xec5597(0xff)](_0x1bb276 => document['querySelector'](_0xec5597(0x12f) + _0x1bb276 + '\x22]')); if (_0x6d4f86) return !![]; _0x52d7bc[_0xec5597(0x13f)](); const _0x2a2965 = Date['now'](); while (Date[_0xec5597(0x115)]() - _0x2a2965 < _0x3d038a) { const _0x55350e = _0x51896f['some'](_0x418bd1 => document[_0xec5597(0x108)]('[name=\x22' + _0x418bd1 + '\x22]')); if (_0x55350e) return !![]; await new Promise(_0x5aa71e => setTimeout(_0x5aa71e, 0x64)); } return console[_0xec5597(0x128)](_0xec5597(0x110), _0x283845), ![]; } async function realUserType(_0x4b6178, _0x2f88f2, _0x327990 = 0xa) { const _0x4e635a = _0x57b5; _0x4b6178[_0x4e635a(0x101)](), _0x4b6178[_0x4e635a(0x106)](new CompositionEvent(_0x4e635a(0x142), { 'bubbles': !![] })); for (let _0x1c4131 = 0x0; _0x1c4131 < _0x2f88f2[_0x4e635a(0x130)]; _0x1c4131++) { const _0x5ce0f8 = _0x2f88f2[_0x1c4131]; _0x4b6178['dispatchEvent'](new KeyboardEvent(_0x4e635a(0xd7), { 'key': _0x5ce0f8, 'code': _0x5ce0f8, 'bubbles': !![] })), _0x4b6178[_0x4e635a(0x106)](new KeyboardEvent('keypress', { 'key': _0x5ce0f8, 'code': _0x5ce0f8, 'bubbles': !![] })); const _0xb23252 = Object[_0x4e635a(0x10e)](window[_0x4e635a(0x122)][_0x4e635a(0x10d)], _0x4e635a(0xe1))[_0x4e635a(0xec)]; _0xb23252['call'](_0x4b6178, _0x4b6178['value'] + _0x5ce0f8), _0x4b6178[_0x4e635a(0x106)](new InputEvent(_0x4e635a(0xf1), { 'data': _0x5ce0f8, 'inputType': _0x4e635a(0xe0), 'bubbles': !![] })), _0x4b6178[_0x4e635a(0x106)](new KeyboardEvent(_0x4e635a(0xf8), { 'key': _0x5ce0f8, 'code': _0x5ce0f8, 'bubbles': !![] })), await new Promise(_0x987ff1 => setTimeout(_0x987ff1, _0x327990)); } _0x4b6178[_0x4e635a(0x106)](new CompositionEvent(_0x4e635a(0x112), { 'data': _0x2f88f2, 'bubbles': !![] })); const _0x360b40 = new DataTransfer(); _0x360b40[_0x4e635a(0x102)](_0x4e635a(0x10f), _0x2f88f2), _0x4b6178[_0x4e635a(0x106)](new ClipboardEvent('paste', { 'clipboardData': _0x360b40, 'bubbles': !![] })), _0x4b6178['dispatchEvent'](new Event('change', { 'bubbles': !![] })); } function setReactInputValue(_0x3d321a, _0x50c229) { const _0x440714 = _0x57b5, _0x218d9b = _0x3d321a[_0x440714(0xe1)]; _0x3d321a[_0x440714(0xe1)] = _0x50c229; const _0x431a2b = _0x3d321a[_0x440714(0x12b)]; if (_0x431a2b) _0x431a2b[_0x440714(0xe8)](_0x218d9b); _0x3d321a['dispatchEvent'](new Event(_0x440714(0xf1), { 'bubbles': !![] })), _0x3d321a['dispatchEvent'](new Event(_0x440714(0xf2), { 'bubbles': !![] })); } async function typeTextSlowly(_0xa9d497, _0x50e75c, _0x32b9ab = 0x5) { const _0x1c55f7 = _0x57b5; _0xa9d497['focus'](), _0xa9d497[_0x1c55f7(0xe1)] = '', _0xa9d497[_0x1c55f7(0x106)](new Event(_0x1c55f7(0xf1), { 'bubbles': !![] })); for (const _0x35df82 of _0x50e75c) { _0xa9d497[_0x1c55f7(0xe1)] += _0x35df82, _0xa9d497[_0x1c55f7(0x106)](new Event(_0x1c55f7(0xf1), { 'bubbles': !![] })), await new Promise(_0x54dc6d => setTimeout(_0x54dc6d, _0x32b9ab)); } } async function selectDropdownUniversal(_0x45326e, _0x55156b) { const _0x54c175 = _0x57b5, _0x189fbd = document['querySelector'](_0x54c175(0x139) + _0x45326e + '\x22]'); if (!_0x189fbd) return ![]; _0x189fbd[_0x54c175(0x101)](), _0x189fbd[_0x54c175(0x13f)](), await new Promise(_0x40ebf6 => setTimeout(_0x40ebf6, 0x32)); let _0xab1ae = _0x189fbd[_0x54c175(0x10c)]('div')?.[_0x54c175(0x108)](_0x54c175(0xd1)); !_0xab1ae && (_0xab1ae = Array['from'](document[_0x54c175(0x11d)]('input[placeholder]'))[_0x54c175(0x136)](_0x3558f3 => _0x3558f3[_0x54c175(0x121)] !== null)); _0xab1ae && (await realUserType(_0xab1ae, _0x55156b, 0x14), await new Promise(_0x2d224d => setTimeout(_0x2d224d, 0x14))); let _0xedbc09 = null; const _0x3f2b57 = Date[_0x54c175(0x115)](); while (Date[_0x54c175(0x115)]() - _0x3f2b57 < 0x3e8) { const _0x41034d = Array[_0x54c175(0x100)](document[_0x54c175(0x11d)](_0x54c175(0x139) + _0x45326e + _0x54c175(0xd3))); _0xedbc09 = _0x41034d['find'](_0x37d130 => (_0x37d130[_0x54c175(0x133)]?.[_0x54c175(0x13e)] || _0x37d130[_0x54c175(0x140)] || '')[_0x54c175(0xde)]()['toLowerCase']() === _0x55156b[_0x54c175(0xde)]()['toLowerCase']()) || _0x41034d[_0x54c175(0x136)](_0x24845e => (_0x24845e[_0x54c175(0x133)]?.['name'] || _0x24845e[_0x54c175(0x140)] || '')['trim']()['toLowerCase']()[_0x54c175(0x127)](_0x55156b[_0x54c175(0xde)]()[_0x54c175(0x10a)]())); if (_0xedbc09) break; await new Promise(_0x4de20a => setTimeout(_0x4de20a, 0x32)); } if (_0xedbc09) return _0xedbc09[_0x54c175(0x13f)](), await new Promise(_0x1c5dbc => setTimeout(_0x1c5dbc, 0x32)), document[_0x54c175(0xd2)][_0x54c175(0x13f)](), !![]; return ![]; } function setReactCheckbox(_0x274faf, _0x20d0db = !![]) { const _0x3730bd = _0x57b5, _0x3a40e3 = document[_0x3730bd(0x108)]('input[type=\x22checkbox\x22][name=\x22' + _0x274faf + '\x22]'); if (_0x3a40e3) { if (_0x3a40e3['checked'] !== _0x20d0db) _0x3a40e3['click'](); return _0x3a40e3['dispatchEvent'](new Event(_0x3730bd(0xf2), { 'bubbles': !![] })), !![]; } return ![]; } async function getDataFromBuffer() { const _0x2b0acd = _0x57b5; try { const _0x1ba3ac = await navigator[_0x2b0acd(0xf4)]['readText'](), _0x331da3 = JSON[_0x2b0acd(0xfa)](_0x1ba3ac); if (_0x331da3?.[_0x2b0acd(0x13b)]) AFM_STATE[_0x2b0acd(0x13b)] = _0x331da3['initiator']; if (_0x331da3?.[_0x2b0acd(0x11f)] && Array[_0x2b0acd(0x105)](_0x331da3[_0x2b0acd(0x11f)])) { const _0x531114 = _0x331da3[_0x2b0acd(0x11f)][_0x2b0acd(0x136)](_0x2b6f68 => _0x2b6f68['Name'] === _0x2b0acd(0x119))?.[_0x2b0acd(0xf9)]; if (_0x531114) AFM_STATE['businessKey'] = _0x531114; } return _0x331da3; } catch (_0x3ac1ab) { return null; } } function getAfmDocId() { const _0x276849 = _0x57b5, _0x57673f = document[_0x276849(0x108)](_0x276849(0x125)); return _0x57673f && typeof _0x57673f[_0x276849(0xe1)] !== _0x276849(0x132) ? String(_0x57673f['value'])[_0x276849(0xde)]() : ''; } function showOverlay(_0x319aad = 'Загрузка...') { const _0x509e4 = _0x57b5; if (document['getElementById']('afm-loading-overlay')) return; const _0x4be6e4 = document[_0x509e4(0xe5)](_0x509e4(0xd8)); _0x4be6e4['id'] = 'afm-loading-overlay', _0x4be6e4['style'] = _0x509e4(0xf6), _0x4be6e4[_0x509e4(0x13a)] = _0x509e4(0x118) + _0x319aad + _0x509e4(0xdf), document['body'][_0x509e4(0xef)](_0x4be6e4); } function hideOverlay() { const _0x11007f = _0x57b5, _0x351925 = document[_0x11007f(0x131)](_0x11007f(0xfb)); if (_0x351925) _0x351925[_0x11007f(0xe9)](); } function showModal(_0x463ab6, _0x518de0) { const _0x564299 = _0x57b5; if (document[_0x564299(0x131)](_0x564299(0x12e))) return; const _0x5e6637 = document[_0x564299(0xe5)](_0x564299(0xe6)); _0x5e6637[_0x564299(0x13a)] = _0x564299(0x120), document[_0x564299(0x113)]['appendChild'](_0x5e6637); const _0x57fe82 = document['createElement']('div'); _0x57fe82['id'] = _0x564299(0x107), _0x57fe82[_0x564299(0x13a)] = _0x564299(0x143) + _0x463ab6 + _0x564299(0xe7), document[_0x564299(0xd2)]['appendChild'](_0x57fe82), document[_0x564299(0x131)]('afm-check-modal-ok')['onclick'] = () => { const _0x22d7e7 = _0x564299; _0x57fe82[_0x22d7e7(0xe9)](), _0x5e6637['remove'](); if (typeof _0x518de0 === 'function') _0x518de0(); }; } function _0x2808() { const _0x356211 = ['сведения\x20об\x20операции', 'button[name=\x22save\x22]', 'afm-check-modal', '[name=\x22', 'length', 'getElementById', 'undefined', 'dataset', 'участник\x201', 'background:#43a047;color:#fff;cursor:pointer;', 'find', 'afm-pulse', 'background:#ffa726;color:#222;cursor:wait;', 'button[name=\x22', 'innerHTML', 'initiator', 'юридический\x20адрес', 'TEXTAREA', 'name', 'click', 'textContent', '7068IVKJAm', 'compositionstart', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22afm-check-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>', 'onclick', 'Идёт\x20автозаполнение\x20формы.\x20Пожалуйста,\x20не\x20кликайте,\x20не\x20используйте\x20клавиатуру\x20и\x20не\x20переходите\x20в\x20другие\x20окна\x20или\x20вкладки\x20до\x20завершения.', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2014px\x2032px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2018px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#1976d2;\x0a\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#fff;\x0a\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20background\x200.2s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20', 'stringify', 'tagName', 'operation.currency', 'innerText', 'observe', 'Проверьте\x20корректность\x20данных\x20с\x20заявки', 'банк\x20участника\x20операции', 'button', 'Ошибка\x20запроса:', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20.afm-pulse\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20afm-pulse-btn\x201.3s\x20infinite;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2010%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translate(-50%,\x2010px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x209999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20@keyframes\x20afm-pulse-btn\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x20box-shadow:\x200\x200\x200\x200\x20#1976d280;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2070%\x20{\x20box-shadow:\x200\x200\x200\x2012px\x20#1976d200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x20box-shadow:\x200\x200\x200\x200\x20#1976d200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20', 'disabled', 'input[placeholder]', 'body', '\x22][type=\x22button\x22]', 'cssText', 'participants[0].document.issue_date', '450555iosPWu', 'keydown', 'div', '8nxxkge', 'FieldType', 'checkbox', 'participants[0].participant', '4934460KBaBun', 'trim', '</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20', 'insertText', 'value', 'https://api.quiq.kz/Application/afmStatus', 'addEventListener', 'operation.number', 'createElement', 'style', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22afm-check-modal-ok\x22>OK</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20', 'setValue', 'remove', 'Заполнить', '18IuCvmh', 'set', 'Name', 'participants[0].legal_address.country', 'appendChild', 'participants[0].full_name.first_name', 'input', 'change', 'background:#ec4141;color:#fff;cursor:pointer;', 'clipboard', 'afm-listener', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x20inset:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.35);\x0a\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2099999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x201rem;\x20color:\x20white;\x20font-family:\x20inherit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20opacity\x200.2s;\x20pointer-events:\x20all;\x0a\x20\x20\x20\x20', 'operation.address.house_number', 'keyup', 'Value', 'parse', 'afm-loading-overlay', 'button[name=\x22subscribe\x22]', '24742Ypebku', 'catch', 'some', 'from', 'focus', 'setData', 'POST', 'participants[0].document.number', 'isArray', 'dispatchEvent', 'afm-check-modal-backdrop', 'querySelector', 'документ,\x20удостоверяющий\x20личность', 'toLowerCase', 'application/json', 'closest', 'prototype', 'getOwnPropertyDescriptor', 'text/plain', '⛔️\x20Аккордеон\x20не\x20раскрыл\x20нужные\x20поля:', 'участники', 'compositionend', 'head', '326536qRCKAa', 'now', '351ukCGYL', 'background:#1976d2;color:#fff;cursor:pointer;', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22padding:\x2032px\x2048px;\x20background:\x20#282c34;\x20border-radius:\x2016px;\x20box-shadow:\x200\x208px\x2040px\x20#0007;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22display:inline-block;\x20margin-right:18px;\x20vertical-align:middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2240\x22\x20height=\x2240\x22\x20viewBox=\x220\x200\x2050\x2050\x22\x20style=\x22vertical-align:middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2225\x22\x20cy=\x2225\x22\x20r=\x2220\x22\x20fill=\x22none\x22\x20stroke=\x22#53e3a6\x22\x20stroke-width=\x225\x22\x20stroke-linecap=\x22round\x22\x20stroke-dasharray=\x2290\x2060\x22\x20stroke-dashoffset=\x220\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<animateTransform\x20attributeName=\x22transform\x22\x20type=\x22rotate\x22\x20from=\x220\x2025\x2025\x22\x20to=\x22360\x2025\x2025\x22\x20dur=\x221.2s\x22\x20repeatCount=\x22indefinite\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>', 'businessKey', 'INPUT', 'error', '876231BnGann', 'querySelectorAll', '191766nyKBjr', 'json', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20#afm-check-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:99999;display:flex;align-items:center;justify-content:center;}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#afm-check-modal{background:#fff;border-radius:12px;padding:32px\x2036px;font-size:1.2rem;box-shadow:0\x208px\x2040px\x20#0005;min-width:260px;text-align:center;}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#afm-check-modal\x20button{margin-top:22px;background:#1976d2;color:#fff;border:none;border-radius:6px;padding:10px\x2034px;font-size:1rem;cursor:pointer;transition:background\x20.2s;}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#afm-check-modal\x20button:hover{background:#0e57a1;}\x0a\x20\x20\x20\x20', 'offsetParent', 'HTMLInputElement', 'Заполняется...', 'setAttribute', 'input[name=\x22form.form_number\x22]', 'participants[0].document.type_document', 'includes', 'warn', 'форма\x20фм-1', 'form.operation_date', '_valueTracker']; _0x2808 = function () { return _0x356211; }; return _0x2808(); } function bindActionButtonOnce(_0x331925, _0x37dbcd) { const _0x9f09ed = _0x57b5; if (!_0x331925 || _0x331925['hasAttribute'](_0x9f09ed(0xf5))) return; _0x331925[_0x9f09ed(0x124)]('afm-listener', '1'), _0x331925[_0x9f09ed(0xe3)](_0x9f09ed(0x13f), async () => { const _0x1e7d2c = _0x9f09ed; await getDataFromBuffer()[_0x1e7d2c(0xfe)](() => { }); const _0x523243 = getAfmDocId(), _0x5ef71e = { 'AfmDocId': _0x523243 || '', 'afmId': _0x523243 || '', 'savedByUser': _0x37dbcd === 0x2 ? AFM_STATE[_0x1e7d2c(0x13b)] || '' : '', 'subscribedByUser': _0x37dbcd === 0x3 ? AFM_STATE['initiator'] || '' : '', 'saveUserIp': '', 'subscribeUserIp': '', 'status': _0x37dbcd }; try { const _0x4cbd99 = await fetch(_0x1e7d2c(0xe2), { 'method': _0x1e7d2c(0x103), 'headers': { 'Content-Type': _0x1e7d2c(0x10b) }, 'body': JSON[_0x1e7d2c(0x147)](_0x5ef71e) }); if (!_0x4cbd99['ok']) throw new Error('Network\x20response\x20was\x20not\x20ok'); } catch (_0x49a0c1) { console[_0x1e7d2c(0x11b)](_0x1e7d2c(0xce), _0x49a0c1); } }); } function observeAndBindActionButtons() { const _0x349f6f = _0x57b5, _0x4e58e4 = () => { const _0x286bb8 = _0x57b5; bindActionButtonOnce(document[_0x286bb8(0x108)](_0x286bb8(0x12d)), 0x2), bindActionButtonOnce(document[_0x286bb8(0x108)](_0x286bb8(0xfc)), 0x3); }; _0x4e58e4(); const _0x4f1cf6 = new MutationObserver(() => _0x4e58e4()); _0x4f1cf6[_0x349f6f(0x14b)](document[_0x349f6f(0xd2)], { 'childList': !![], 'subtree': !![] }); } function _0x57b5(_0x91ee30, _0xd9498f) { const _0x280842 = _0x2808(); return _0x57b5 = function (_0x57b5b9, _0x9c679b) { _0x57b5b9 = _0x57b5b9 - 0xce; let _0x5c6afe = _0x280842[_0x57b5b9]; return _0x5c6afe; }, _0x57b5(_0x91ee30, _0xd9498f); } (function () { 'use strict'; const _0x5e589a = _0x57b5; const _0x1fdecf = document[_0x5e589a(0xe5)]('style'); _0x1fdecf[_0x5e589a(0x13a)] = _0x5e589a(0xcf), document[_0x5e589a(0x113)][_0x5e589a(0xef)](_0x1fdecf); const _0x1073a9 = document[_0x5e589a(0xe5)](_0x5e589a(0x14e)); _0x1073a9['innerText'] = 'Заполнить', _0x1073a9['className'] = _0x5e589a(0x137), _0x1073a9[_0x5e589a(0xe6)] = _0x5e589a(0x146); const _0x929f68 = _0x5e589a(0x117), _0x33d0a9 = _0x5e589a(0x138), _0x8ec10d = _0x5e589a(0x135), _0x8664f9 = _0x5e589a(0xf3); observeAndBindActionButtons(), setInterval(async () => { const _0x32f612 = _0x5e589a, _0x522d63 = await getDataFromBuffer(); _0x522d63 == null ? (_0x1073a9[_0x32f612(0xd0)] = !![], _0x1073a9['innerText'] = 'Нет\x20данных.\x20Нажмите\x20кнопку\x20АФМ\x20в\x20заявке.', _0x1073a9['style'] = _0x1073a9[_0x32f612(0xe6)][_0x32f612(0xd4)] + _0x8664f9) : (_0x1073a9['disabled'] = ![], _0x1073a9[_0x32f612(0x14a)] = _0x32f612(0xea), _0x1073a9[_0x32f612(0xe6)] = _0x1073a9['style'][_0x32f612(0xd4)] + _0x929f68); }, 0x5dc), _0x1073a9[_0x5e589a(0x144)] = async () => { const _0x295b75 = _0x5e589a; _0x1073a9[_0x295b75(0xd0)] = !![], _0x1073a9[_0x295b75(0x14a)] = _0x295b75(0x123), _0x1073a9[_0x295b75(0xe6)] = _0x1073a9[_0x295b75(0xe6)][_0x295b75(0xd4)] + _0x33d0a9, showOverlay(_0x295b75(0x145)), ((async () => { const _0x361416 = _0x295b75, _0x31105d = await getDataFromBuffer(); await new Promise(_0x9f2899 => setTimeout(_0x9f2899, 0x64)); if (_0x31105d?.[_0x361416(0x11f)] == null) { _0x1073a9['disabled'] = ![], _0x1073a9[_0x361416(0x14a)] = _0x361416(0xea), _0x1073a9[_0x361416(0xe6)] = _0x1073a9[_0x361416(0xe6)][_0x361416(0xd4)] + _0x929f68, hideOverlay(), alert('Нет\x20данных.\x20Нажмите\x20кнопку\x20АФМ\x20в\x20заявке.'); return; } await openAccordionByHeader(_0x361416(0x129), ['form.operation_state', _0x361416(0x12a)]), await openAccordionByHeader(_0x361416(0x12c), [_0x361416(0xe4), _0x361416(0x149)]), await new Promise(_0x28ba64 => setTimeout(_0x28ba64, 0xc8)); const _0xcfe403 = _0x31105d['json'][_0x361416(0x136)](_0xdce51a => _0xdce51a['Name'] === 'businessKey')?.[_0x361416(0xf9)]; if (_0xcfe403) AFM_STATE[_0x361416(0x119)] = _0xcfe403; if (_0x31105d['initiator']) AFM_STATE[_0x361416(0x13b)] = _0x31105d['initiator']; for (const _0x25a773 of _0x31105d['json']) { _0x25a773['Name'] === _0x361416(0xf7) && (await openAccordionByHeader(_0x361416(0x111), ['participants[0].participant', 'participants[0].iin']), await openAccordionByHeader(_0x361416(0x134), [_0x361416(0xdc)]), await openAccordionByHeader(_0x361416(0x14d), ['participants[0].bank.country']), await openAccordionByHeader(_0x361416(0x13c), [_0x361416(0xee)]), await openAccordionByHeader('фактический\x20адрес', ['participants[0].address.country'])); _0x25a773['Name'] === 'participants[0].iin' && (await openAccordionByHeader('фио', ['participants[0].full_name.last_name', _0x361416(0xf0)]), await openAccordionByHeader(_0x361416(0x109), [_0x361416(0x126), _0x361416(0x104), _0x361416(0xd5)])); if (_0x25a773[_0x361416(0xda)] === _0x361416(0xf1)) { let _0x28bff0 = document[_0x361416(0x108)](_0x361416(0x12f) + _0x25a773['Name'] + '\x22]'); if (!_0x28bff0) { const _0x32fddd = Date[_0x361416(0x115)](); while (!_0x28bff0 && Date['now']() - _0x32fddd < 0x7d0) { await new Promise(_0x3bc11e => setTimeout(_0x3bc11e, 0x64)), _0x28bff0 = document[_0x361416(0x108)](_0x361416(0x12f) + _0x25a773['Name'] + '\x22]'); } } if (_0x28bff0 && (_0x28bff0[_0x361416(0x148)] === _0x361416(0x11a) || _0x28bff0[_0x361416(0x148)] === _0x361416(0x13d))) { setReactInputValue(_0x28bff0, _0x25a773[_0x361416(0xf9)]); continue; } } if (_0x25a773[_0x361416(0xda)] === 'select') { await selectDropdownUniversal(_0x25a773[_0x361416(0xed)], _0x25a773[_0x361416(0xf9)]); continue; } if (_0x25a773[_0x361416(0xda)] === _0x361416(0xdb)) { setReactCheckbox(_0x25a773[_0x361416(0xed)], _0x25a773['Value']); continue; } } _0x1073a9['disabled'] = ![], _0x1073a9[_0x361416(0xe6)] = _0x1073a9[_0x361416(0xe6)]['cssText'] + _0x8ec10d, _0x1073a9[_0x361416(0x14a)] = _0x361416(0xea), hideOverlay(), showModal(_0x361416(0x14c)); })()), await new Promise(_0x2bef60 => setTimeout(_0x2bef60, 0x32)); }, document[_0x5e589a(0xd2)]['appendChild'](_0x1073a9); }());