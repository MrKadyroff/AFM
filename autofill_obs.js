// ==UserScript==
// @name         AFM
// @namespace    http://tampermonkey.net/
// @version      1.4
// @description  Заполняет форму AFM корректно для React-порталов. Ранний мониторинг кнопок Сохранить/Подписать. AfmDocId из form.form_number.
// @author       Ecash
// @match        https://websfm.kz/form-fm/*
// @grant        none
// ==/UserScript==

/* =========================
   [0] Глобальное состояние
   ========================= */
const _0x3c9cc4 = _0x20f0; (function (_0x40b32b, _0x51ddc2) { const _0x295ef1 = _0x20f0, _0x47c4a7 = _0x40b32b(); while (!![]) { try { const _0x43f266 = parseInt(_0x295ef1(0x15b)) / 0x1 + parseInt(_0x295ef1(0x1b5)) / 0x2 * (parseInt(_0x295ef1(0x19a)) / 0x3) + -parseInt(_0x295ef1(0x17b)) / 0x4 + -parseInt(_0x295ef1(0x189)) / 0x5 + parseInt(_0x295ef1(0x147)) / 0x6 * (-parseInt(_0x295ef1(0x164)) / 0x7) + parseInt(_0x295ef1(0x171)) / 0x8 * (-parseInt(_0x295ef1(0x16d)) / 0x9) + -parseInt(_0x295ef1(0x199)) / 0xa * (-parseInt(_0x295ef1(0x182)) / 0xb); if (_0x43f266 === _0x51ddc2) break; else _0x47c4a7['push'](_0x47c4a7['shift']()); } catch (_0x4bb778) { _0x47c4a7['push'](_0x47c4a7['shift']()); } } }(_0x5106, 0x1d1b2)); const AFM_STATE = { 'businessKey': '', 'initiator': '' }; async function waitForElement(_0x27180a, _0x51c034 = 0xc8) { const _0xdf3369 = _0x20f0, _0x24c371 = Date[_0xdf3369(0x15f)](); while (Date[_0xdf3369(0x15f)]() - _0x24c371 < _0x51c034) { let _0x349f5e = document['querySelector'](_0x27180a); if (_0x349f5e) return _0x349f5e; await new Promise(_0x140ccb => setTimeout(_0x140ccb, 0x32)); } return null; } async function openAccordionByHeader(_0x4c72fe, _0x2e96b1 = [], _0x43761e = 0x5dc) { const _0x12a0d0 = _0x20f0, _0x55a16c = Array['from'](document[_0x12a0d0(0x18a)]('p'))['find'](_0x5e864c => _0x5e864c[_0x12a0d0(0x179)][_0x12a0d0(0x1ac)]()[_0x12a0d0(0x153)]()[_0x12a0d0(0x180)](_0x4c72fe[_0x12a0d0(0x1ac)]()['toLowerCase']())); if (!_0x55a16c) return ![]; const _0x410492 = _0x55a16c[_0x12a0d0(0x166)](_0x12a0d0(0x175)); if (!_0x410492) return ![]; const _0x219cd2 = _0x2e96b1[_0x12a0d0(0x173)](_0x2ef625 => document[_0x12a0d0(0x194)](_0x12a0d0(0x19c) + _0x2ef625 + '\x22]')); if (_0x219cd2) return !![]; _0x410492[_0x12a0d0(0x193)](); const _0x5a0607 = Date[_0x12a0d0(0x15f)](); while (Date[_0x12a0d0(0x15f)]() - _0x5a0607 < _0x43761e) { const _0x399d3a = _0x2e96b1[_0x12a0d0(0x173)](_0x5017a3 => document[_0x12a0d0(0x194)](_0x12a0d0(0x19c) + _0x5017a3 + '\x22]')); if (_0x399d3a) return !![]; await new Promise(_0x1deb50 => setTimeout(_0x1deb50, 0x64)); } return console[_0x12a0d0(0x17a)](_0x12a0d0(0x19b), _0x4c72fe), ![]; } async function realUserType(_0x4fc3d0, _0x15a55a, _0x275538 = 0xa) { const _0x590104 = _0x20f0; _0x4fc3d0[_0x590104(0x1a3)](), _0x4fc3d0['dispatchEvent'](new CompositionEvent('compositionstart', { 'bubbles': !![] })); for (let _0x44f303 = 0x0; _0x44f303 < _0x15a55a['length']; _0x44f303++) { const _0x54b95c = _0x15a55a[_0x44f303]; _0x4fc3d0['dispatchEvent'](new KeyboardEvent(_0x590104(0x150), { 'key': _0x54b95c, 'code': _0x54b95c, 'bubbles': !![] })), _0x4fc3d0[_0x590104(0x1ae)](new KeyboardEvent('keypress', { 'key': _0x54b95c, 'code': _0x54b95c, 'bubbles': !![] })); const _0x1509b4 = Object['getOwnPropertyDescriptor'](window['HTMLInputElement']['prototype'], _0x590104(0x160))[_0x590104(0x198)]; _0x1509b4[_0x590104(0x156)](_0x4fc3d0, _0x4fc3d0[_0x590104(0x160)] + _0x54b95c), _0x4fc3d0[_0x590104(0x1ae)](new InputEvent('input', { 'data': _0x54b95c, 'inputType': _0x590104(0x186), 'bubbles': !![] })), _0x4fc3d0['dispatchEvent'](new KeyboardEvent(_0x590104(0x174), { 'key': _0x54b95c, 'code': _0x54b95c, 'bubbles': !![] })), await new Promise(_0x315e3d => setTimeout(_0x315e3d, _0x275538)); } _0x4fc3d0[_0x590104(0x1ae)](new CompositionEvent(_0x590104(0x151), { 'data': _0x15a55a, 'bubbles': !![] })); const _0x4ed7af = new DataTransfer(); _0x4ed7af[_0x590104(0x1af)](_0x590104(0x170), _0x15a55a), _0x4fc3d0[_0x590104(0x1ae)](new ClipboardEvent(_0x590104(0x1ad), { 'clipboardData': _0x4ed7af, 'bubbles': !![] })), _0x4fc3d0[_0x590104(0x1ae)](new Event(_0x590104(0x1a0), { 'bubbles': !![] })); } function setReactInputValue(_0x7f3a6e, _0x334c6e) { const _0x155807 = _0x20f0, _0x5e71dc = _0x7f3a6e[_0x155807(0x160)]; _0x7f3a6e['value'] = _0x334c6e; const _0x382c24 = _0x7f3a6e[_0x155807(0x19d)]; if (_0x382c24) _0x382c24[_0x155807(0x1b4)](_0x5e71dc); _0x7f3a6e['dispatchEvent'](new Event(_0x155807(0x1bb), { 'bubbles': !![] })), _0x7f3a6e[_0x155807(0x1ae)](new Event(_0x155807(0x1a0), { 'bubbles': !![] })); } function _0x5106() { const _0x4bce87 = ['136805vRsdjV', 'application/json', 'participants[0].full_name.first_name', 'button[name=\x22save\x22]', 'now', 'value', 'FieldType', 'participants[0].iin', 'from', '3409RAEogg', 'onclick', 'closest', 'participants[0].full_name.last_name', 'head', 'Value', 'input[placeholder]', 'participants[0].participant', 'addEventListener', '234thNFtb', 'participants[0].address.country', 'банк\x20участника\x20операции', 'text/plain', '45488bqNKhw', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x20inset:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.35);\x0a\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2099999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x201rem;\x20color:\x20white;\x20font-family:\x20inherit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20opacity\x200.2s;\x20pointer-events:\x20all;\x0a\x20\x20\x20\x20', 'some', 'keyup', 'div', 'input[name=\x22form.form_number\x22]', 'participants[0].document.type_document', 'сведения\x20об\x20операции', 'textContent', 'warn', '356884LtIOtE', 'businessKey', 'фактический\x20адрес', 'Name', 'remove', 'includes', 'style', '1111uhSPiw', 'background:#ec4141;color:#fff;cursor:pointer;', 'POST', 'getElementById', 'insertText', '\x22][type=\x22button\x22]', 'find', '1024460MVAhqJ', 'querySelectorAll', 'документ,\x20удостоверяющий\x20личность', 'disabled', 'undefined', 'function', 'TEXTAREA', 'button[name=\x22subscribe\x22]', 'dataset', 'button[name=\x22', 'click', 'querySelector', 'afm-listener', 'catch', 'participants[0].legal_address.country', 'set', '29990kGbyBY', '2220IIUGcl', '⛔️\x20Аккордеон\x20не\x20раскрыл\x20нужные\x20поля:', '[name=\x22', '_valueTracker', 'checkbox', 'readText', 'change', 'className', 'tagName', 'focus', 'Загрузка...', 'innerHTML', 'afm-loading-overlay', 'body', 'Ошибка\x20запроса:', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20.afm-pulse\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20afm-pulse-btn\x201.3s\x20infinite;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2010%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translate(-50%,\x2010px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x209999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20@keyframes\x20afm-pulse-btn\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x20box-shadow:\x200\x200\x200\x200\x20#1976d280;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2070%\x20{\x20box-shadow:\x200\x200\x200\x2012px\x20#1976d200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x20box-shadow:\x200\x200\x200\x200\x20#1976d200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20', 'button', 'afm-check-modal-ok', 'trim', 'paste', 'dispatchEvent', 'setData', 'name', 'createElement', 'innerText', 'фио', 'setValue', '606UHIffA', 'afm-pulse', 'json', 'юридический\x20адрес', 'form.operation_state', 'input[type=\x22checkbox\x22][name=\x22', 'input', 'error', 'parse', 'observe', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22padding:\x2032px\x2048px;\x20background:\x20#282c34;\x20border-radius:\x2016px;\x20box-shadow:\x200\x208px\x2040px\x20#0007;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22display:inline-block;\x20margin-right:18px;\x20vertical-align:middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2240\x22\x20height=\x2240\x22\x20viewBox=\x220\x200\x2050\x2050\x22\x20style=\x22vertical-align:middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2225\x22\x20cy=\x2225\x22\x20r=\x2220\x22\x20fill=\x22none\x22\x20stroke=\x22#53e3a6\x22\x20stroke-width=\x225\x22\x20stroke-linecap=\x22round\x22\x20stroke-dasharray=\x2290\x2060\x22\x20stroke-dashoffset=\x220\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<animateTransform\x20attributeName=\x22transform\x22\x20type=\x22rotate\x22\x20from=\x220\x2025\x2025\x22\x20to=\x22360\x2025\x2025\x22\x20dur=\x221.2s\x22\x20repeatCount=\x22indefinite\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>', '1266VSBgqD', 'participants[0].document.issue_date', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20#afm-check-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:99999;display:flex;align-items:center;justify-content:center;}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#afm-check-modal{background:#fff;border-radius:12px;padding:32px\x2036px;font-size:1.2rem;box-shadow:0\x208px\x2040px\x20#0005;min-width:260px;text-align:center;}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#afm-check-modal\x20button{margin-top:22px;background:#1976d2;color:#fff;border:none;border-radius:6px;padding:10px\x2034px;font-size:1rem;cursor:pointer;transition:background\x20.2s;}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#afm-check-modal\x20button:hover{background:#0e57a1;}\x0a\x20\x20\x20\x20', 'Network\x20response\x20was\x20not\x20ok', 'clipboard', 'appendChild', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2014px\x2032px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2018px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#1976d2;\x0a\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#fff;\x0a\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20background\x200.2s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20', 'INPUT', 'afm-check-modal', 'keydown', 'compositionend', 'participants[0].bank.country', 'toLowerCase', 'setAttribute', 'checked', 'call', 'operation.currency', 'initiator', 'Заполнить', 'cssText']; _0x5106 = function () { return _0x4bce87; }; return _0x5106(); } async function typeTextSlowly(_0xf70214, _0x536d2b, _0x179a3d = 0x5) { const _0x15488e = _0x20f0; _0xf70214[_0x15488e(0x1a3)](), _0xf70214[_0x15488e(0x160)] = '', _0xf70214[_0x15488e(0x1ae)](new Event(_0x15488e(0x1bb), { 'bubbles': !![] })); for (const _0x2ea2b9 of _0x536d2b) { _0xf70214[_0x15488e(0x160)] += _0x2ea2b9, _0xf70214[_0x15488e(0x1ae)](new Event('input', { 'bubbles': !![] })), await new Promise(_0x54e9c8 => setTimeout(_0x54e9c8, _0x179a3d)); } } async function selectDropdownUniversal(_0x22f5db, _0x5bf4ee) { const _0x39c597 = _0x20f0, _0x402339 = document[_0x39c597(0x194)](_0x39c597(0x192) + _0x22f5db + '\x22]'); if (!_0x402339) return ![]; _0x402339[_0x39c597(0x1a3)](), _0x402339[_0x39c597(0x193)](), await new Promise(_0x2518e4 => setTimeout(_0x2518e4, 0x32)); let _0x17ecf6 = _0x402339[_0x39c597(0x166)]('div')?.[_0x39c597(0x194)](_0x39c597(0x16a)); !_0x17ecf6 && (_0x17ecf6 = Array[_0x39c597(0x163)](document[_0x39c597(0x18a)](_0x39c597(0x16a)))[_0x39c597(0x188)](_0x27ab56 => _0x27ab56['offsetParent'] !== null)); _0x17ecf6 && (await realUserType(_0x17ecf6, _0x5bf4ee, 0x14), await new Promise(_0x5ea8c3 => setTimeout(_0x5ea8c3, 0x14))); let _0x586a56 = null; const _0x44ce27 = Date['now'](); while (Date[_0x39c597(0x15f)]() - _0x44ce27 < 0x3e8) { const _0x4e9042 = Array['from'](document[_0x39c597(0x18a)](_0x39c597(0x192) + _0x22f5db + _0x39c597(0x187))); _0x586a56 = _0x4e9042[_0x39c597(0x188)](_0x43da38 => (_0x43da38[_0x39c597(0x191)]?.[_0x39c597(0x1b0)] || _0x43da38['textContent'] || '')[_0x39c597(0x1ac)]()[_0x39c597(0x153)]() === _0x5bf4ee[_0x39c597(0x1ac)]()[_0x39c597(0x153)]()) || _0x4e9042[_0x39c597(0x188)](_0x705441 => (_0x705441[_0x39c597(0x191)]?.[_0x39c597(0x1b0)] || _0x705441[_0x39c597(0x179)] || '')[_0x39c597(0x1ac)]()[_0x39c597(0x153)]()[_0x39c597(0x180)](_0x5bf4ee[_0x39c597(0x1ac)]()[_0x39c597(0x153)]())); if (_0x586a56) break; await new Promise(_0x39e706 => setTimeout(_0x39e706, 0x32)); } if (_0x586a56) return _0x586a56[_0x39c597(0x193)](), await new Promise(_0x3161c1 => setTimeout(_0x3161c1, 0x32)), document['body'][_0x39c597(0x193)](), !![]; return ![]; } function setReactCheckbox(_0x5f2861, _0x4a429a = !![]) { const _0x3c8c8e = _0x20f0, _0x215916 = document[_0x3c8c8e(0x194)](_0x3c8c8e(0x1ba) + _0x5f2861 + '\x22]'); if (_0x215916) { if (_0x215916[_0x3c8c8e(0x155)] !== _0x4a429a) _0x215916[_0x3c8c8e(0x193)](); return _0x215916[_0x3c8c8e(0x1ae)](new Event(_0x3c8c8e(0x1a0), { 'bubbles': !![] })), !![]; } return ![]; } async function getDataFromBuffer() { const _0x1a82a1 = _0x20f0; try { const _0x11286c = await navigator[_0x1a82a1(0x14b)][_0x1a82a1(0x19f)](), _0x136ad3 = JSON[_0x1a82a1(0x1bd)](_0x11286c); if (_0x136ad3?.[_0x1a82a1(0x158)]) AFM_STATE[_0x1a82a1(0x158)] = _0x136ad3[_0x1a82a1(0x158)]; if (_0x136ad3?.[_0x1a82a1(0x1b7)] && Array['isArray'](_0x136ad3[_0x1a82a1(0x1b7)])) { const _0x4c4e39 = _0x136ad3[_0x1a82a1(0x1b7)][_0x1a82a1(0x188)](_0x2e8550 => _0x2e8550[_0x1a82a1(0x17e)] === _0x1a82a1(0x17c))?.['Value']; if (_0x4c4e39) AFM_STATE[_0x1a82a1(0x17c)] = _0x4c4e39; } return _0x136ad3; } catch (_0x1b0173) { return null; } } function getAfmDocId() { const _0x2b402b = _0x20f0, _0x19d3c7 = document[_0x2b402b(0x194)](_0x2b402b(0x176)); return _0x19d3c7 && typeof _0x19d3c7[_0x2b402b(0x160)] !== _0x2b402b(0x18d) ? String(_0x19d3c7[_0x2b402b(0x160)])[_0x2b402b(0x1ac)]() : ''; } function showOverlay(_0x2ccc7b = _0x3c9cc4(0x1a4)) { const _0x571c1d = _0x3c9cc4; if (document['getElementById'](_0x571c1d(0x1a6))) return; const _0x31c478 = document[_0x571c1d(0x1b1)]('div'); _0x31c478['id'] = _0x571c1d(0x1a6), _0x31c478[_0x571c1d(0x181)] = _0x571c1d(0x172), _0x31c478[_0x571c1d(0x1a5)] = _0x571c1d(0x146) + _0x2ccc7b + '</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20', document['body'][_0x571c1d(0x14c)](_0x31c478); } function hideOverlay() { const _0x4e30e5 = _0x3c9cc4, _0x143bdb = document[_0x4e30e5(0x185)](_0x4e30e5(0x1a6)); if (_0x143bdb) _0x143bdb['remove'](); } function showModal(_0x25ade7, _0x2273c1) { const _0x2d8153 = _0x3c9cc4; if (document[_0x2d8153(0x185)](_0x2d8153(0x14f))) return; const _0x10ee65 = document[_0x2d8153(0x1b1)](_0x2d8153(0x181)); _0x10ee65[_0x2d8153(0x1a5)] = _0x2d8153(0x149), document[_0x2d8153(0x168)][_0x2d8153(0x14c)](_0x10ee65); const _0x2479c4 = document[_0x2d8153(0x1b1)](_0x2d8153(0x175)); _0x2479c4['id'] = 'afm-check-modal-backdrop', _0x2479c4[_0x2d8153(0x1a5)] = '\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22afm-check-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>' + _0x25ade7 + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22afm-check-modal-ok\x22>OK</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20', document[_0x2d8153(0x1a7)][_0x2d8153(0x14c)](_0x2479c4), document[_0x2d8153(0x185)](_0x2d8153(0x1ab))[_0x2d8153(0x165)] = () => { const _0x83fd49 = _0x2d8153; _0x2479c4[_0x83fd49(0x17f)](), _0x10ee65['remove'](); if (typeof _0x2273c1 === _0x83fd49(0x18e)) _0x2273c1(); }; } function _0x20f0(_0x17d4ac, _0x1025de) { const _0x51066f = _0x5106(); return _0x20f0 = function (_0x20f0b3, _0x585d2d) { _0x20f0b3 = _0x20f0b3 - 0x145; let _0x56d664 = _0x51066f[_0x20f0b3]; return _0x56d664; }, _0x20f0(_0x17d4ac, _0x1025de); } function bindActionButtonOnce(_0xd18576, _0x462423) { const _0x2db4d2 = _0x3c9cc4; if (!_0xd18576 || _0xd18576['hasAttribute'](_0x2db4d2(0x195))) return; _0xd18576[_0x2db4d2(0x154)](_0x2db4d2(0x195), '1'), _0xd18576[_0x2db4d2(0x16c)](_0x2db4d2(0x193), async () => { const _0x27ac1e = _0x2db4d2; await getDataFromBuffer()[_0x27ac1e(0x196)](() => { }); const _0xfd06ad = getAfmDocId(), _0x3c338a = { 'requestId': AFM_STATE[_0x27ac1e(0x17c)] || '', 'AfmDocId': _0xfd06ad || '', 'afmId': _0xfd06ad || '', 'savedByUser': _0x462423 === 0x2 ? AFM_STATE[_0x27ac1e(0x158)] || '' : '', 'subscribedByUser': _0x462423 === 0x3 ? AFM_STATE['initiator'] || '' : '', 'saveUserIp': '', 'subscribeUserIp': '', 'status': _0x462423 }; try { const _0x179380 = await fetch('https://api.quiq.kz/Application/afmStatus', { 'method': _0x27ac1e(0x184), 'headers': { 'Content-Type': _0x27ac1e(0x15c) }, 'body': JSON['stringify'](_0x3c338a) }); if (!_0x179380['ok']) throw new Error(_0x27ac1e(0x14a)); } catch (_0xc44439) { console[_0x27ac1e(0x1bc)](_0x27ac1e(0x1a8), _0xc44439); } }); } function observeAndBindActionButtons() { const _0x2c20c9 = _0x3c9cc4, _0x33753b = () => { const _0x4b0b2b = _0x20f0; bindActionButtonOnce(document[_0x4b0b2b(0x194)](_0x4b0b2b(0x15e)), 0x2), bindActionButtonOnce(document[_0x4b0b2b(0x194)](_0x4b0b2b(0x190)), 0x3); }; _0x33753b(); const _0x52efea = new MutationObserver(() => _0x33753b()); _0x52efea[_0x2c20c9(0x145)](document[_0x2c20c9(0x1a7)], { 'childList': !![], 'subtree': !![] }); } (function () { 'use strict'; const _0x49bbcc = _0x3c9cc4; const _0x345309 = document[_0x49bbcc(0x1b1)](_0x49bbcc(0x181)); _0x345309[_0x49bbcc(0x1a5)] = _0x49bbcc(0x1a9), document[_0x49bbcc(0x168)]['appendChild'](_0x345309); const _0x317097 = document[_0x49bbcc(0x1b1)](_0x49bbcc(0x1aa)); _0x317097[_0x49bbcc(0x1b2)] = _0x49bbcc(0x159), _0x317097[_0x49bbcc(0x1a1)] = _0x49bbcc(0x1b6), _0x317097['style'] = _0x49bbcc(0x14d); const _0x57b044 = 'background:#1976d2;color:#fff;cursor:pointer;', _0x4d7d0a = 'background:#ffa726;color:#222;cursor:wait;', _0x533da1 = 'background:#43a047;color:#fff;cursor:pointer;', _0x38e4d8 = _0x49bbcc(0x183); observeAndBindActionButtons(), setInterval(async () => { const _0x1ec679 = _0x49bbcc, _0x1eaede = await getDataFromBuffer(); _0x1eaede == null ? (_0x317097[_0x1ec679(0x18c)] = !![], _0x317097[_0x1ec679(0x1b2)] = 'Нет\x20данных.\x20Нажмите\x20кнопку\x20АФМ\x20в\x20заявке.', _0x317097[_0x1ec679(0x181)] = _0x317097['style'][_0x1ec679(0x15a)] + _0x38e4d8) : (_0x317097[_0x1ec679(0x18c)] = ![], _0x317097[_0x1ec679(0x1b2)] = _0x1ec679(0x159), _0x317097[_0x1ec679(0x181)] = _0x317097[_0x1ec679(0x181)][_0x1ec679(0x15a)] + _0x57b044); }, 0x5dc), _0x317097[_0x49bbcc(0x165)] = async () => { const _0x17ae72 = _0x49bbcc; _0x317097[_0x17ae72(0x18c)] = !![], _0x317097[_0x17ae72(0x1b2)] = 'Заполняется...', _0x317097[_0x17ae72(0x181)] = _0x317097[_0x17ae72(0x181)][_0x17ae72(0x15a)] + _0x4d7d0a, showOverlay('Идёт\x20автозаполнение\x20формы.\x20Пожалуйста,\x20не\x20кликайте,\x20не\x20используйте\x20клавиатуру\x20и\x20не\x20переходите\x20в\x20другие\x20окна\x20или\x20вкладки\x20до\x20завершения.'), ((async () => { const _0x4e7a30 = _0x17ae72, _0x5b2ad3 = await getDataFromBuffer(); await new Promise(_0x2c2115 => setTimeout(_0x2c2115, 0x64)); if (_0x5b2ad3?.['json'] == null) { _0x317097[_0x4e7a30(0x18c)] = ![], _0x317097[_0x4e7a30(0x1b2)] = _0x4e7a30(0x159), _0x317097[_0x4e7a30(0x181)] = _0x317097[_0x4e7a30(0x181)][_0x4e7a30(0x15a)] + _0x57b044, hideOverlay(), alert('Нет\x20данных.\x20Нажмите\x20кнопку\x20АФМ\x20в\x20заявке.'); return; } await openAccordionByHeader('форма\x20фм-1', [_0x4e7a30(0x1b9), 'form.operation_date']), await openAccordionByHeader(_0x4e7a30(0x178), ['operation.number', _0x4e7a30(0x157)]), await new Promise(_0x48a304 => setTimeout(_0x48a304, 0xc8)); const _0x14bec5 = _0x5b2ad3['json'][_0x4e7a30(0x188)](_0x185c35 => _0x185c35['Name'] === _0x4e7a30(0x17c))?.[_0x4e7a30(0x169)]; if (_0x14bec5) AFM_STATE['businessKey'] = _0x14bec5; if (_0x5b2ad3[_0x4e7a30(0x158)]) AFM_STATE[_0x4e7a30(0x158)] = _0x5b2ad3['initiator']; for (const _0xee1f32 of _0x5b2ad3[_0x4e7a30(0x1b7)]) { _0xee1f32[_0x4e7a30(0x17e)] === 'operation.address.house_number' && (await openAccordionByHeader('участники', [_0x4e7a30(0x16b), _0x4e7a30(0x162)]), await openAccordionByHeader('участник\x201', [_0x4e7a30(0x16b)]), await openAccordionByHeader(_0x4e7a30(0x16f), [_0x4e7a30(0x152)]), await openAccordionByHeader(_0x4e7a30(0x1b8), [_0x4e7a30(0x197)]), await openAccordionByHeader(_0x4e7a30(0x17d), [_0x4e7a30(0x16e)])); _0xee1f32[_0x4e7a30(0x17e)] === _0x4e7a30(0x162) && (await openAccordionByHeader(_0x4e7a30(0x1b3), [_0x4e7a30(0x167), _0x4e7a30(0x15d)]), await openAccordionByHeader(_0x4e7a30(0x18b), [_0x4e7a30(0x177), 'participants[0].document.number', _0x4e7a30(0x148)])); if (_0xee1f32[_0x4e7a30(0x161)] === _0x4e7a30(0x1bb)) { let _0x44b47f = document['querySelector']('[name=\x22' + _0xee1f32[_0x4e7a30(0x17e)] + '\x22]'); if (!_0x44b47f) { const _0x2b7219 = Date['now'](); while (!_0x44b47f && Date[_0x4e7a30(0x15f)]() - _0x2b7219 < 0x7d0) { await new Promise(_0x139fbc => setTimeout(_0x139fbc, 0x64)), _0x44b47f = document[_0x4e7a30(0x194)](_0x4e7a30(0x19c) + _0xee1f32['Name'] + '\x22]'); } } if (_0x44b47f && (_0x44b47f[_0x4e7a30(0x1a2)] === _0x4e7a30(0x14e) || _0x44b47f['tagName'] === _0x4e7a30(0x18f))) { setReactInputValue(_0x44b47f, _0xee1f32[_0x4e7a30(0x169)]); continue; } } if (_0xee1f32['FieldType'] === 'select') { await selectDropdownUniversal(_0xee1f32[_0x4e7a30(0x17e)], _0xee1f32['Value']); continue; } if (_0xee1f32['FieldType'] === _0x4e7a30(0x19e)) { setReactCheckbox(_0xee1f32['Name'], _0xee1f32[_0x4e7a30(0x169)]); continue; } } _0x317097['disabled'] = ![], _0x317097[_0x4e7a30(0x181)] = _0x317097[_0x4e7a30(0x181)][_0x4e7a30(0x15a)] + _0x533da1, _0x317097[_0x4e7a30(0x1b2)] = _0x4e7a30(0x159), hideOverlay(), showModal('Проверьте\x20корректность\x20данных\x20с\x20заявки'); })()), await new Promise(_0x307721 => setTimeout(_0x307721, 0x32)); }, document[_0x49bbcc(0x1a7)][_0x49bbcc(0x14c)](_0x317097); }());
